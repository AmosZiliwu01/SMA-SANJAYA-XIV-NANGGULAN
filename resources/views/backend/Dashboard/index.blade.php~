@extends('backend.layout.main')
@section('title', 'Dashboard')
@section('content')

    <div class="container-fluid py-4">
        <div class="row">
            {{-- Common Cards for All Users --}}
            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Pengunjung Hari Ini</p>
                                    <h5 class="font-weight-bolder">
                                        {{ $visitorCountToday ?? 0 }}
                                    </h5>
                                    <p class="mb-0 text-sm">
                                        <span class="text-success font-weight-bolder">{{ now()->format('d M Y') }}</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                                    <i class="ni ni-world text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Pengunjung</p>
                                    <h5 class="font-weight-bolder">
                                        {{ number_format($totalUniqueVisitors ?? 0) }}
                                    </h5>
                                    <p class="mb-0 text-sm">
                                        <span class="text-info font-weight-bolder">Visitor ID Unik</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                                    <i class="ni ni-single-02 text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Artikel</p>
                                    <h5 class="font-weight-bolder">
                                        {{ number_format($totalPosts ?? 0) }}
                                    </h5>
                                    <p class="mb-0 text-sm">
                                        <span class="text-success font-weight-bolder">Semua Artikel</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                                    <i class="ni ni-paper-diploma text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                <div class="card">
                    <div class="card-body p-3">
                        <div class="row">
                            <div class="col-8">
                                <div class="numbers">
                                    <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Galeri</p>
                                    <h5 class="font-weight-bolder">
                                        {{ number_format($totalGalleries ?? 0) }}
                                    </h5>
                                    <p class="mb-0 text-sm">
                                        <span class="text-warning font-weight-bolder">Foto Galeri</span>
                                    </p>
                                </div>
                            </div>
                            <div class="col-4 text-end">
                                <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                                    <i class="ni ni-image text-lg opacity-10" aria-hidden="true"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        {{-- Admin Only Section --}}
        @can('admin')
            <div class="row mt-4">
                {{-- Admin Stats Cards --}}
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Pengguna</p>
                                        <h5 class="font-weight-bolder">{{ isset($adminData['totalUsers']) ? number_format($adminData['totalUsers']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-primary font-weight-bolder">Registered Users</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                                        <i class="ni ni-circle-08 text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Guru</p>
                                        <h5 class="font-weight-bolder">{{ isset($adminData['totalTeachers']) ? number_format($adminData['totalTeachers']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-info font-weight-bolder">Tenaga Pengajar</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                                        <i class="ni ni-hat-3 text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Siswa</p>
                                        <h5 class="font-weight-bolder">{{ isset($adminData['totalStudents']) ? number_format($adminData['totalStudents']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-success font-weight-bolder">{{ isset($adminData['totalClasses']) ? number_format($adminData['totalClasses']) : 0 }} Kelas</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                                        <i class="ni ni-books text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Pesan Masuk</p>
                                        <h5 class="font-weight-bolder">{{ isset($adminData['unreadMessages']) ? number_format($adminData['unreadMessages']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-danger font-weight-bolder">Belum Dibaca</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-danger shadow-danger text-center rounded-circle">
                                        <i class="ni ni-email-83 text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Admin Charts --}}
            <div class="row mt-4">
                <div class="col-lg-8 mb-lg-0 mb-4">
                    <div class="card z-index-2 h-100">
                        <div class="card-header pb-0 pt-3 bg-transparent">
                            <h6 class="text-capitalize">Statistik Pengunjung (Tahun Ini)</h6>
                            <p class="text-sm mb-0">
                                <i class="fa fa-arrow-up text-success"></i>
                                <span class="font-weight-bold">Pengunjung Unik Bulanan</span>
                            </p>
                        </div>
                        <div class="card-body p-3">
                            <div class="chart">
                                <canvas id="chart-visitors" class="chart-canvas" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3 col-12 d-flex justify-content-center">
                            <div class="btn-group" role="group">
                                <div class="mb-4 d-flex justify-content-center align-items-center">
                                    <div class="segmented-control">
                                        <button type="button" class="segment-btn active" onclick="toggle3('categories', this)">
                                            Kategori Populer
                                        </button>
                                        <button type="button" class="segment-btn" onclick="toggle3('posts', this)">
                                            Postingan Populer
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card-body p-3">
                            <!-- Kategori Populer Content -->
                            <div id="categories-content">
                                @if(isset($adminData['topCategories']) && !empty($adminData['topCategories']) && (is_countable($adminData['topCategories']) ? count($adminData['topCategories']) > 0 : $adminData['topCategories']->count() > 0))
                                    @php
                                        $categories = is_array($adminData['topCategories']) ? collect($adminData['topCategories']) : $adminData['topCategories'];
                                        $maxPostsCount = max($categories->max('posts_count') ?? 1, 1);
                                    @endphp
                                    @foreach($categories as $category)
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div>
                                                <h6 class="mb-0 text-sm">{{ $category->name ?? 'Kategori Tidak Diketahui' }}</h6>
                                                <span class="text-xs text-secondary">{{ ($category->posts_count ?? 0) }} artikel</span>
                                            </div>
                                            <div class="progress" style="width: 60px; height: 6px;">
                                                <div class="progress-bar bg-gradient-primary"
                                                     style="width: {{ $maxPostsCount > 0 ? (($category->posts_count ?? 0) / $maxPostsCount) * 100 : 0 }}%"></div>
                                            </div>
                                        </div>
                                    @endforeach
                                @else
                                    <div class="text-center py-4">
                                        <i class="ni ni-folder-17 text-muted" style="font-size: 2rem;"></i>
                                        <p class="text-muted text-center mt-2 mb-0">Belum ada data kategori</p>
                                        <small class="text-xs text-muted">Data akan muncul setelah ada artikel dengan kategori</small>
                                    </div>
                                @endif
                            </div>

                            <!-- Postingan Populer Content -->
                            <div id="posts-content" style="display: none;">
                                @php
                                    $topPosts = null;
                                    if (isset($adminData['topPosts']) && !empty($adminData['topPosts'])) {
                                        $topPosts = is_array($adminData['topPosts']) ? collect($adminData['topPosts']) : $adminData['topPosts'];
                                    } elseif (isset($authorData['topPosts']) && !empty($authorData['topPosts'])) {
                                        $topPosts = is_array($authorData['topPosts']) ? collect($authorData['topPosts']) : $authorData['topPosts'];
                                    }
                                @endphp

                                @if($topPosts && (is_countable($topPosts) ? count($topPosts) > 0 : $topPosts->count() > 0))
                                    @foreach($topPosts as $post)
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <div class="flex-grow-1">
                                                <h6 class="mb-0 text-sm">{{ isset($post->title) ? Str::limit($post->title, 40) : 'Judul Tidak Tersedia' }}</h6>
                                                <span class="text-xs text-secondary">{{ number_format($post->views ?? 0) }} views</span>
                                            </div>
                                            <div class="text-end">
                                                <span class="badge badge-sm bg-gradient-success">{{ number_format($post->views ?? 0) }}</span>
                                            </div>
                                        </div>
                                    @endforeach
                                @else
                                    <div class="text-center py-4">
                                        <i class="ni ni-paper-diploma text-muted" style="font-size: 2rem;"></i>
                                        <p class="text-muted text-center mt-2 mb-0">Belum ada data postingan</p>
                                        <small class="text-xs text-muted">Data akan muncul setelah ada artikel yang dilihat</small>
                                    </div>
                                @endif
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Recent Messages for Admin --}}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h6>Pesan Terbaru</h6>
                        </div>
                        <div class="card-body">
                            @if(isset($adminData['recentMessages']) && !empty($adminData['recentMessages']) && (is_countable($adminData['recentMessages']) ? count($adminData['recentMessages']) > 0 : $adminData['recentMessages']->count() > 0))
                                @php
                                    $messages = is_array($adminData['recentMessages']) ? collect($adminData['recentMessages']) : $adminData['recentMessages'];
                                @endphp
                                @foreach($messages as $message)
                                    <div class="d-flex align-items-center mb-3 p-2 border-radius-lg border">
                                        <div class="flex-grow-1">
                                            <h6 class="mb-1">{{ $message->name ?? 'Pengirim Tidak Diketahui' }}</h6>
                                            <p class="text-sm mb-0">{{ isset($message->message) ? Str::limit($message->message, 100) : 'Pesan tidak tersedia' }}</p>
                                            <small class="text-muted">
                                                @if(isset($message->created_at))
                                                    {{ $message->created_at->diffForHumans() }}
                                                @else
                                                    Waktu tidak tersedia
                                                @endif
                                            </small>
                                        </div>
                                        <div>
                                            <span class="badge bg-gradient-warning">Baru</span>
                                        </div>
                                    </div>
                                @endforeach
                            @else
                                <div class="text-center py-4">
                                    <i class="ni ni-email-83 text-muted" style="font-size: 3rem;"></i>
                                    <p class="text-muted text-center mt-3 mb-0">Tidak ada pesan baru</p>
                                    <small class="text-xs text-muted">Pesan akan muncul di sini ketika ada yang menghubungi</small>
                                </div>
                            @endif
                        </div>
                    </div>
                </div>
            </div>
        @endcan

        {{-- Author Only Section --}}
        @can('author')
            <div class="row mt-4">
                {{-- Author Stats Cards --}}
                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Artikel Saya</p>
                                        <h5 class="font-weight-bolder">{{ isset($authorData['myPosts']) ? number_format($authorData['myPosts']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-primary font-weight-bolder">Total Artikel</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-primary shadow-primary text-center rounded-circle">
                                        <i class="ni ni-paper-diploma text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Total Views</p>
                                        <h5 class="font-weight-bolder">{{ number_format($authorData['totalViews'] ?? 0) }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-success font-weight-bolder">Pembaca</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-success shadow-success text-center rounded-circle">
                                        <i class="ni ni-chart-bar-32 text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Galeri Saya</p>
                                        <h5 class="font-weight-bolder">{{ isset($authorData['myGalleries']) ? number_format($authorData['myGalleries']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-info font-weight-bolder">Total Foto</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-info shadow-info text-center rounded-circle">
                                        <i class="ni ni-image text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-xl-3 col-sm-6 mb-xl-0 mb-4">
                    <div class="card">
                        <div class="card-body p-3">
                            <div class="row">
                                <div class="col-8">
                                    <div class="numbers">
                                        <p class="text-sm mb-0 text-uppercase font-weight-bold">Agenda Saya</p>
                                        <h5 class="font-weight-bolder">{{ isset($authorData['myAgendas']) ? number_format($authorData['myAgendas']) : 0 }}</h5>
                                        <p class="mb-0 text-sm">
                                            <span class="text-warning font-weight-bolder">Total Agenda</span>
                                        </p>
                                    </div>
                                </div>
                                <div class="col-4 text-end">
                                    <div class="icon icon-shape bg-gradient-warning shadow-warning text-center rounded-circle">
                                        <i class="ni ni-calendar-grid-58 text-lg opacity-10"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Author Charts --}}
            <div class="row mt-4">
                <div class="col-lg-8 mb-lg-0 mb-4">
                    <div class="card z-index-2 h-100">
                        <div class="card-header pb-0 pt-3 bg-transparent">
                            <h6 class="text-capitalize">Artikel Bulanan (Tahun Ini)</h6>
                            <p class="text-sm mb-0">
                                <i class="fa fa-arrow-up text-success"></i>
                                <span class="font-weight-bold">Produktivitas Menulis</span>
                            </p>
                        </div>
                        <div class="card-body p-3">
                            <div class="chart">
                                <canvas id="chart-posts" class="chart-canvas" height="300"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card h-100">
                        <div class="card-header pb-0 p-3">
                            <h6 class="mb-3">Artikel Terpopuler</h6>
                        </div>
                        <div class="card-body p-3">
                            @if(isset($authorData['topPosts']) && !empty($authorData['topPosts']) && (is_countable($authorData['topPosts']) ? count($authorData['topPosts']) > 0 : $authorData['topPosts']->count() > 0))
                                @php
                                    $authorTopPosts = is_array($authorData['topPosts']) ? collect($authorData['topPosts']) : $authorData['topPosts'];
                                @endphp
                                @foreach($authorTopPosts as $post)
                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                        <div>
                                            <h6 class="mb-0 text-sm">{{ isset($post->title) ? Str::limit($post->title, 30) : 'Judul Tidak Tersedia' }}</h6>
                                            <span class="text-xs text-secondary">{{ number_format($post->views ?? 0) }} views</span>
                                        </div>
                                        <div class="text-end">
                                            <span class="badge badge-sm bg-gradient-success">{{ number_format($post->views ?? 0) }}</span>
                                        </div>
                                    </div>
                                @endforeach
                            @else
                                <div class="text-center py-4">
                                    <i class="ni ni-paper-diploma text-muted" style="font-size: 2rem;"></i>
                                    <p class="text-muted text-center mt-2 mb-0">Belum ada artikel</p>
                                    <small class="text-xs text-muted">Mulai menulis artikel untuk melihat statistik</small>
                                </div>
                            @endif
                        </div>
                    </div>
                </div>
            </div>

            {{-- Recent Posts for Author --}}
            <div class="row mt-4">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h6>Artikel Terbaru Anda</h6>
                        </div>
                        <div class="card-body">
                            @if(isset($authorData['recentPosts']) && !empty($authorData['recentPosts']) && (is_countable($authorData['recentPosts']) ? count($authorData['recentPosts']) > 0 : $authorData['recentPosts']->count() > 0))
                                @php
                                    $recentPosts = is_array($authorData['recentPosts']) ? collect($authorData['recentPosts']) : $authorData['recentPosts'];
                                @endphp
                                @foreach($recentPosts as $post)
                                    <div class="d-flex align-items-center mb-3 p-2 border-radius-lg border">
                                        <div class="flex-grow-1 me-3">
                                            <h6 class="mb-1">{{ $post->title ?? 'Judul Tidak Tersedia' }}</h6>
                                            <p class="text-sm mb-0">
                                                @if(isset($post->content))
                                                    {{ Str::limit(strip_tags($post->content), 100) }}
                                                @else
                                                    Konten tidak tersedia
                                                @endif
                                            </p>
                                            <small class="text-muted">
                                                @if(isset($post->created_at))
                                                    {{ $post->created_at->diffForHumans() }}
                                                @else
                                                    Waktu tidak tersedia
                                                @endif
                                                â€¢ {{ number_format($post->views ?? 0) }} views
                                            </small>
                                        </div>
                                        <div>
                                            @if(isset($post->slug))
                                                <a href="{{ route('fe-post.detail', $post->slug) }}" class="btn btn-sm btn-outline-primary">
                                                    <i class="fas fa-eye me-2"></i> Lihat
                                                </a>
                                            @else
                                                <button class="btn btn-sm btn-outline-secondary" disabled>
                                                    <i class="fas fa-eye me-2"></i> Tidak Tersedia
                                                </button>
                                            @endif
                                        </div>
                                    </div>
                                @endforeach
                            @else
                                <div class="text-center py-4">
                                    <i class="ni ni-paper-diploma text-muted" style="font-size: 3rem;"></i>
                                    <p class="text-muted text-center mt-3 mb-0">Belum ada artikel</p>
                                    <small class="text-xs text-muted">Artikel terbaru Anda akan muncul di sini</small>
                                </div>
                            @endif
                        </div>
                    </div>
                </div>
            </div>
        @endcan

        {{-- Activity Logs (Common for both) --}}
        <div class="row mt-4">
            <div class="col-12 mb-4">
                <div class="card">
                    <div class="card-header pl-3 py-2 d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="mb-0">Aktivitas Terkini</h6>
                            <p class="text-sm mb-0">Riwayat aktivitas sistem terbaru</p>
                        </div>
                    </div>
                    <div class="card-body px-0 pt-0 pb-2">
                        <div class="table-responsive p-0">
                            <table class="table align-items-center mb-0">
                                <thead>
                                <tr>
                                    <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7">Pengguna</th>
                                    <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7 ps-2">Aktivitas</th>
                                    <th class="text-uppercase text-secondary text-xs font-weight-bolder opacity-7 ps-2">Waktu</th>
                                </tr>
                                </thead>
                                <tbody>
                                @if(isset($activityLogs) && !empty($activityLogs) && (is_countable($activityLogs) ? count($activityLogs) > 0 : $activityLogs->count() > 0))
                                    @php
                                        $logs = is_array($activityLogs) ? collect($activityLogs) : $activityLogs;
                                    @endphp
                                    @foreach ($logs as $log)
                                        <tr>
                                            <td>
                                                <div class="d-flex px-2 py-1">
                                                    <div>
<<<<<<<<<<<<<<  âœ¨ Codeium Command ðŸŒŸ >>>>>>>>>>>>>>>>
                                                        <img src="{{ (isset($log->user) && isset($log->user->photo)) ? asset('storage/' . $log->user->photo) : asset('assets/img/user.jpg') }}"
                                                        <img src="{{ (isset($log->user) && isset($log->user->photo)) ? $log->user->photo : asset('assets/img/user.jpg') }}"
                                                             class="avatar avatar-sm me-3" alt="user">
<<<<<<<  f34a74ce-f1d1-4ab6-b651-d7f221e6122e  >>>>>>>
                                                    </div>
                                                    <div class="d-flex flex-column justify-content-center">
                                                        <h6 class="mb-0 text-sm">{{ (isset($log->user) && isset($log->user->name)) ? $log->user->name : 'System' }}</h6>
                                                        <p class="text-xs text-secondary mb-0">{{ (isset($log->user) && isset($log->user->email)) ? $log->user->email : '-' }}</p>
                                                    </div>
                                                </div>
                                            </td>
                                            <td>
                                                <div class="d-flex flex-column justify-content-center">
                                                    <h6 class="mb-0 text-sm">{{ $log->action ?? 'Aktivitas Tidak Diketahui' }}</h6>

                                                    <p class="text-xs text-secondary mb-0">
                                                        {{ \Carbon\Carbon::parse($log->logged_at)->format('d M Y, H:i') }}
                                                    </p>
                                                </div>
                                            </td>
                                            <td>
                                                <span class="text-secondary text-xs font-weight-bold">
                                                    @if(isset($log->created_at))
                                                        {{ $log->created_at->diffForHumans() }}
                                                    @else
                                                        Waktu tidak tersedia
                                                    @endif
                                                </span>
                                            </td>
                                        </tr>
                                    @endforeach
                                @else
                                    <tr>
                                        <td colspan="3" class="text-center py-4">
                                            <i class="ni ni-time-alarm text-muted" style="font-size: 2rem;"></i>
                                            <p class="text-muted text-center mt-2 mb-0">Belum ada aktivitas</p>
                                            <small class="text-xs text-muted">Aktivitas sistem akan muncul di sini</small>
                                        </td>
                                    </tr>
                                @endif
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    @push('scripts')
        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                @can('admin')
                // Visitor Chart for Admin
                if (document.getElementById('chart-visitors')) {
                    const visitorsData = @json($adminData['monthlyVisitors'] ?? []);
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                    const visitorCounts = Array(12).fill(0);

                    // Proses data pengunjung bulanan seperti chart posts
                    if (visitorsData && Array.isArray(visitorsData) && visitorsData.length > 0) {
                        visitorsData.forEach(item => {
                            if (item && item.month && item.month >= 1 && item.month <= 12) {
                                visitorCounts[item.month - 1] = item.count || 0;
                            }
                        });
                    }

                    new Chart(document.getElementById('chart-visitors'), {
                        type: 'line',
                        data: {
                            labels: months, // Menggunakan array months langsung
                            datasets: [{
                                label: 'Pengunjung Unik',
                                data: visitorCounts, // Menggunakan visitorCounts yang sudah diproses
                                borderColor: '#5e72e4',
                                backgroundColor: 'rgba(94, 114, 228, 0.1)',
                                borderWidth: 2,
                                fill: true,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
                @endcan

                @can('author')
                // Posts Chart for Author
                if (document.getElementById('chart-posts')) {
                    const monthlyPostsData = @json($authorData['monthlyPosts'] ?? []);
                    const months = ['Jan', 'Feb', 'Mar', 'Apr', 'Mei', 'Jun', 'Jul', 'Agu', 'Sep', 'Okt', 'Nov', 'Des'];
                    const postCounts = Array(12).fill(0);

                    if (monthlyPostsData && Array.isArray(monthlyPostsData) && monthlyPostsData.length > 0) {
                        monthlyPostsData.forEach(item => {
                            if (item && item.month && item.month >= 1 && item.month <= 12) {
                                postCounts[item.month - 1] = item.count || 0;
                            }
                        });
                    }

                    new Chart(document.getElementById('chart-posts'), {
                        type: 'bar',
                        data: {
                            labels: months,
                            datasets: [{
                                label: 'Artikel',
                                data: postCounts,
                                backgroundColor: '#11cdef',
                                borderRadius: 4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    ticks: {
                                        stepSize: 1
                                    }
                                }
                            },
                            plugins: {
                                legend: {
                                    display: false
                                }
                            }
                        }
                    });
                }
                @endcan
            });
        </script>
        <script>
            // Style 3: Segmented Control
            function toggle3(type, button) {
                // Check if button and its parent exist
                if (!button || !button.parentElement) {
                    console.error('Button or parent element not found');
                    return;
                }

                button.parentElement.querySelectorAll('.segment-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                button.classList.add('active');
                toggleContent(type);
            }

            function toggleContent(type) {
                const categoriesContent = document.getElementById('categories-content');
                const postsContent = document.getElementById('posts-content');
                const btnCategories = document.getElementById('btn-categories');
                const btnPosts = document.getElementById('btn-posts');

                // Check if elements exist before manipulating them
                if (!categoriesContent || !postsContent) {
                    console.error('Content elements not found');
                    return;
                }

                if (type === 'categories') {
                    // Show categories, hide posts
                    categoriesContent.style.display = 'block';
                    postsContent.style.display = 'none';

                    // Update button states if they exist
                    if (btnCategories) {
                        btnCategories.classList.add('active');
                        btnCategories.classList.remove('btn-outline-primary');
                        btnCategories.classList.add('btn-primary');
                    }

                    if (btnPosts) {
                        btnPosts.classList.remove('active');
                        btnPosts.classList.remove('btn-primary');
                        btnPosts.classList.add('btn-outline-primary');
                    }
                } else {
                    // Show posts, hide categories
                    categoriesContent.style.display = 'none';
                    postsContent.style.display = 'block';

                    // Update button states if they exist
                    if (btnPosts) {
                        btnPosts.classList.add('active');
                        btnPosts.classList.remove('btn-outline-primary');
                        btnPosts.classList.add('btn-primary');
                    }

                    if (btnCategories) {
                        btnCategories.classList.remove('active');
                        btnCategories.classList.remove('btn-primary');
                        btnCategories.classList.add('btn-outline-primary');
                    }
                }
            }
        </script>
    @endpush

@endsection
